<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TUA 2026 Vision Survey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .survey-wrapper {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.6s ease forwards;
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header {
            background: linear-gradient(135deg, #0066cc 0%, #004499 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .page {
            display: none;
            padding: 40px;
            min-height: 400px;
            opacity: 0;
            transform: translateX(30px);
            transition: all 0.4s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }

        .page h2 {
            color: #0066cc;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 500;
        }

        .intro-text {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #0066cc;
            line-height: 1.8;
        }

        .question-group {
            margin-bottom: 30px;
        }

        .question-label {
            font-weight: 600;
            margin-bottom: 15px;
            color: #444;
            font-size: 1.1em;
        }

        .radio-group, .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .radio-option:hover, .checkbox-option:hover {
            background: #e9ecef;
            transform: translateX(5px);
            border-color: #0066cc;
        }

        input[type="radio"], input[type="checkbox"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        input[type="radio"]:checked + label,
        input[type="checkbox"]:checked + label {
            color: #0066cc;
            font-weight: 600;
        }

        .checkbox-section {
            margin-bottom: 30px;
        }

        .checkbox-section h3 {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #0066cc;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            background: #0052a3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-container {
            padding: 20px 40px;
            background: #f8f9fa;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0066cc 0%, #004499 100%);
            border-radius: 4px;
            transition: width 0.6s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .committee-badge {
            display: inline-block;
            background: #0066cc;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 10px;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .thank-you-icon {
            font-size: 4em;
            text-align: center;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hidden {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .page {
                padding: 25px;
            }
            
            .navigation {
                padding: 20px 25px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9em;
            }
        }

        /* Export Modal Styles */
        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .export-modal-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.4s ease;
        }

        .export-modal-content h3 {
            color: #0066cc;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .export-modal-content p {
            margin-bottom: 30px;
            color: #666;
        }

        .export-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .export-buttons .btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.1em;
            padding: 15px 20px;
        }

        @media (max-width: 500px) {
            .export-modal-content {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="survey-wrapper">
            <div class="header">
                <h1>TUA 2026 Vision Survey</h1>
                <p>å…±å‰µå°ç£æ³Œå°¿ç§‘é†«å­¸æœƒçš„æœªä¾†é¡˜æ™¯</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progressText">é–‹å§‹å•å·</div>
            </div>

            <!-- Page 1: Introduction -->
            <div class="page active" id="page1">
                <h2>æ­¡è¿åƒèˆ‡ TUA 2026 é¡˜æ™¯èª¿æŸ¥</h2>
                <div class="intro-text">
                    <p>è¦ªæ„›çš„é†«å±€æœ‹å‹ï¼Œæ‚¨å¥½ï¼š</p>
                    <p>ç‚ºå‡èšç«¶é¸ã€Œ2026 å°ç£æ³Œå°¿ç§‘é†«å­¸æœƒ (TUA) ç†äº‹é•·ã€çš„æ”¿è¦‹äº®é»ï¼Œä¸¦ç¢ºä¿æ¯ä¸€é …è¦åŠƒéƒ½èƒ½åˆ‡å¯¦å›æ‡‰æœƒå“¡çš„éœ€æ±‚ï¼Œæˆ‘å€‘ç‰¹åˆ¥è¨­è¨ˆäº†é€™ä»½åŒ¿åå•å·ã€‚</p>
                    <p>æ‚¨çš„æ´è¦‹è‡³é—œé‡è¦ã€‚ç„¡è«–æ˜¯é—œæ–¼å„å§”å“¡æœƒçš„æœªä¾†é‹ä½œã€é†«å­¸ä¸­å¿ƒèˆ‡åŸºå±¤é™¢æ‰€çš„å‡è¡¡ç™¼å±•ï¼Œæˆ–æ˜¯å­¸æœƒçš„å‰µæ–°æ–¹å‘ï¼Œæˆ‘å€‘éƒ½èª æ‘¯åœ°é‚€è«‹æ‚¨ç›´è¨€åˆ†äº«ã€‚</p>
                    <p><strong>æœ¬å•å·æ¡åŒ¿ååˆ¶</strong>ï¼Œæ‰€æœ‰è³‡æ–™åƒ…ä¾›å…§éƒ¨æ”¿è¦‹è¦åŠƒä½¿ç”¨ï¼Œçµ•ä¸å¤–æµï¼Œæ•¬è«‹æ”¾å¿ƒã€‚é è¨ˆå¡«ç­”æ™‚é–“ç´„ 5-10 åˆ†é˜ï¼Œæ„Ÿè¬æ‚¨æ’¥å†—å”åŠ©ï¼Œä¸€åŒç‚º TUA çš„æœªä¾†è²¢ç»å¿ƒåŠ›ï¼</p>
                </div>
            </div>

            <!-- Page 2: Basic Background -->
            <div class="page" id="page2">
                <h2>åŸºæœ¬èƒŒæ™¯è³‡è¨Šï¼ˆé¸å¡«ï¼‰</h2>
                <div class="intro-text">
                    <p>ç‚ºäº†è®“æˆ‘å€‘èƒ½æ›´æ·±å…¥åœ°äº†è§£ä¸åŒæœƒå“¡ç¾¤é«”çš„éœ€æ±‚ï¼Œå¸Œæœ›æ‚¨èƒ½æä¾›ä¸€äº›èƒŒæ™¯è³‡è¨Šã€‚æ­¤éƒ¨åˆ†ç‚º<strong>é¸å¡«</strong>ï¼Œä¸”æ‰€æœ‰é¸é …çš†ç‚º<strong>é¡åˆ¥å¼</strong>ï¼Œç„¡æ³•è¿½æº¯è‡³å€‹äººï¼Œè«‹å®‰å¿ƒå¡«å¯«ã€‚</p>
                </div>

                <div class="question-group">
                    <div class="question-label">1. æ‚¨ç›®å‰ä¸»è¦çš„åŸ·æ¥­å ´æ‰€é¡å‹ç‚ºï¼Ÿ</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="workplace" value="medical-center">
                            <span>é†«å­¸ä¸­å¿ƒ</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="workplace" value="regional-hospital">
                            <span>å€åŸŸé†«é™¢</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="workplace" value="district-hospital">
                            <span>åœ°å€é†«é™¢</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="workplace" value="clinic">
                            <span>åŸºå±¤è¨ºæ‰€</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="workplace" value="other">
                            <span>å…¶ä»–</span>
                        </label>
                    </div>
                </div>

                <div class="question-group">
                    <div class="question-label">2. æ‚¨çš„æ³Œå°¿ç§‘åŸ·æ¥­å¹´è³‡ç´„ç‚ºï¼Ÿ</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="experience" value="junior">
                            <span>5å¹´ä»¥ä¸‹ (é’å¹´é†«å¸«)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="experience" value="mid-career">
                            <span>6-15å¹´ (ä¸­ç”Ÿä»£é†«å¸«)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="experience" value="senior">
                            <span>16å¹´ä»¥ä¸Š (è³‡æ·±é†«å¸«)</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Page 3: Overall Vision (moved from second to last) -->
            <div class="page" id="page3">
                <h2>ç¸½çµèˆ‡äº®é»æ”¿è¦‹</h2>
                <div class="intro-text">
                    <p>åœ¨æ·±å…¥äº†è§£å„å§”å“¡æœƒä¹‹å‰ï¼Œæˆ‘å€‘æƒ³å…ˆè«‹æ•™æ‚¨å° TUA æ•´é«”ç™¼å±•çš„å®è§€çœ‹æ³•ã€‚</p>
                </div>

                <div class="question-group">
                    <div class="question-label">1. è·¨é ˜åŸŸç¶œåˆå»ºè­°</div>
                    <p style="margin-bottom: 10px; color: #666;">æ‚¨å° TUA æœ‰ä»»ä½•è·¨é ˜åŸŸçš„ç¶œåˆæ€§å»ºè­°å—ï¼Ÿ(ä¾‹å¦‚ï¼šå¦‚ä½•ä¿ƒé€²ä¸åŒå§”å“¡æœƒé–“çš„åˆä½œã€å¦‚ä½•å¹³è¡¡é†«å­¸ä¸­å¿ƒèˆ‡åŸºå±¤çš„éœ€æ±‚ã€å¦‚ä½•æå‡ TUA çš„ç¤¾æœƒå½±éŸ¿åŠ›ç­‰)</p>
                    <textarea id="crossDisciplinary" placeholder="è«‹åˆ†äº«æ‚¨çš„è·¨é ˜åŸŸå»ºè­°..."></textarea>
                </div>

                <div class="question-group">
                    <div class="question-label">2. æ‚¨çš„äº®é»æ”¿è¦‹ (Highlight Policy)</div>
                    <p style="margin-bottom: 10px; color: #666;">å¦‚æœæ‚¨æ˜¯å€™é¸äººï¼Œæ‚¨æœƒæå‡ºä»€éº¼æ¨£çš„ã€Œäº®é»æ”¿è¦‹ã€ä¾†çˆ­å–æœƒå“¡æ”¯æŒï¼Ÿé€™å€‹æƒ³æ³•å¯èƒ½æ˜¯ä¸€å€‹å‰µæ–°çš„è¨ˆç•«ã€ä¸€å€‹å¤§è†½çš„æ”¹é©ï¼Œæˆ–æ˜¯ä¸€å€‹èƒ½å‡èšæ‰€æœ‰æœƒå“¡å‘å¿ƒåŠ›çš„ç›®æ¨™ã€‚</p>
                    <textarea id="highlightPolicy" placeholder="è«‹åˆ†äº«æ‚¨çš„äº®é»æ”¿è¦‹..."></textarea>
                </div>
            </div>

            <!-- Page 4: Committee Selection (moved from page 3) -->
            <div class="page" id="page4">
                <h2>æ‚¨å¸Œæœ›å°å“ªäº›å§”å“¡æœƒçš„é‹ä½œèˆ‡ç™¼å±•æä¾›å»ºè­°ï¼Ÿ</h2>
                <div class="intro-text">
                    <p>äº†è§£æ‚¨çš„æ•´é«”é¡˜æ™¯å¾Œï¼Œç¾åœ¨è«‹å‹¾é¸æ‚¨æƒ³è¦æä¾›å…·é«”å»ºè­°çš„å§”å“¡æœƒã€‚æ¥ä¸‹ä¾†ï¼Œå•å·å°‡æœƒé‡å°æ‚¨å‹¾é¸çš„æ¯ä¸€å€‹é …ç›®ï¼Œå€‹åˆ¥è«‹æ•™æ‚¨çš„çœ‹æ³•ã€‚</p>
                </div>

                <div class="checkbox-section">
                    <h3>å­¸è¡“æ€§å§”å“¡æœƒ</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="academic-general">
                            <span>å­¸è¡“æ€§å§”å“¡æœƒ (ç¸½é«”)</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="uro-oncology">
                            <span>æ³Œå°¿è…«ç˜¤å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="robotic-laparoscopic">
                            <span>æ©Ÿå™¨æ‰‹è‡‚æš¨è…¹è…”é¡æ‰‹è¡“å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="functional-urology">
                            <span>åŠŸèƒ½æ€§æ³Œå°¿å­¸å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="urolithiasis">
                            <span>å°¿è·¯çµçŸ³å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="infection-inflammation">
                            <span>æ„ŸæŸ“èˆ‡ç™¼ç‚å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="kidney-transplant">
                            <span>è…è‡Ÿç§»æ¤å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="pediatric-urology">
                            <span>å°å…’æ³Œå°¿å­¸å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="andrology">
                            <span>ç”·æ€§å­¸å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="joint-research">
                            <span>è¯åˆç ”ç©¶å§”å“¡æœƒ</span>
                        </label>
                    </div>
                </div>

                <div class="checkbox-section">
                    <h3>äº‹å‹™æ€§å§”å“¡æœƒ</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="administrative-general">
                            <span>äº‹å‹™æ€§å§”å“¡æœƒ (ç¸½é«”)</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="international-affairs">
                            <span>åœ‹éš›äº‹å‹™å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="education">
                            <span>æ•™è‚²å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="insurance-self-pay">
                            <span>å¥ä¿åŠè‡ªè²»é†«ç™‚å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="journal">
                            <span>å­¸æœƒé›œèªŒå§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="training-accreditation">
                            <span>è¨“ç·´é†«é™¢è©•é‘‘å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="specialist-review">
                            <span>å°ˆç§‘é†«å¸«ç”„å¯©å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="it-online-education">
                            <span>è³‡è¨Šæš¨ç·šä¸Šæ•™è‚²å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="primary-care">
                            <span>åŸºå±¤é†«ç™‚å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="innovation">
                            <span>æ–°å‰µå§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="medical-policy-pr">
                            <span>é†«ç™‚æ”¿ç­–æš¨å…¬å…±é—œä¿‚å§”å“¡æœƒ</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="committees" value="young-urologists">
                            <span>é’å¹´äº‹å‹™å§”å“¡æœƒ</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Dynamic Committee Pages will be inserted here -->

            <!-- Thank You Page -->
            <div class="page" id="thankYouPage">
                <div class="thank-you-icon">ğŸ‰</div>
                <h2>å•å·å®Œæˆï¼Œç”±è¡·æ„Ÿè¬ï¼</h2>
                <div class="intro-text">
                    <p>å†æ¬¡æ„Ÿè¬æ‚¨æ’¥å†—å¡«å¯«å•å·ï¼Œæä¾›å¦‚æ­¤å¯¶è²´çš„æ´è¦‹ã€‚æ‚¨çš„æ¯ä¸€å¥è©±ï¼Œéƒ½æ˜¯æˆ‘å€‘æ“˜åŠƒ TUA æœªä¾†è—åœ–çš„é‡è¦åŸºçŸ³ã€‚</p>
                    <p>æˆ‘å€‘å°‡ä»”ç´°ç ”è®€æ‰€æœ‰å›é¥‹ï¼Œä¸¦å°‡å…¶èå…¥æˆ‘å€‘çš„æ”¿è¦‹ä¹‹ä¸­ã€‚</p>
                    <p>æ•¬ç¥ é †å¿ƒã€å¹³å®‰ï¼</p>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="changePage(-1)" disabled>ä¸Šä¸€é </button>
                <button class="btn btn-primary" id="nextBtn" onclick="changePage(1)">ä¸‹ä¸€é </button>
            </div>
        </div>
    </div>

    <!-- åŠ å…¥å¿…è¦çš„å¤–éƒ¨è³‡æº -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <script>
        // Committee names mapping
        const committeeNames = {
            'academic-general': 'å­¸è¡“æ€§å§”å“¡æœƒ (ç¸½é«”)',
            'uro-oncology': 'æ³Œå°¿è…«ç˜¤å§”å“¡æœƒ',
            'robotic-laparoscopic': 'æ©Ÿå™¨æ‰‹è‡‚æš¨è…¹è…”é¡æ‰‹è¡“å§”å“¡æœƒ',
            'functional-urology': 'åŠŸèƒ½æ€§æ³Œå°¿å­¸å§”å“¡æœƒ',
            'urolithiasis': 'å°¿è·¯çµçŸ³å§”å“¡æœƒ',
            'infection-inflammation': 'æ„ŸæŸ“èˆ‡ç™¼ç‚å§”å“¡æœƒ',
            'kidney-transplant': 'è…è‡Ÿç§»æ¤å§”å“¡æœƒ',
            'pediatric-urology': 'å°å…’æ³Œå°¿å­¸å§”å“¡æœƒ',
            'andrology': 'ç”·æ€§å­¸å§”å“¡æœƒ',
            'joint-research': 'è¯åˆç ”ç©¶å§”å“¡æœƒ',
            'administrative-general': 'äº‹å‹™æ€§å§”å“¡æœƒ (ç¸½é«”)',
            'international-affairs': 'åœ‹éš›äº‹å‹™å§”å“¡æœƒ',
            'education': 'æ•™è‚²å§”å“¡æœƒ',
            'insurance-self-pay': 'å¥ä¿åŠè‡ªè²»é†«ç™‚å§”å“¡æœƒ',
            'journal': 'å­¸æœƒé›œèªŒå§”å“¡æœƒ',
            'training-accreditation': 'è¨“ç·´é†«é™¢è©•é‘‘å§”å“¡æœƒ',
            'specialist-review': 'å°ˆç§‘é†«å¸«ç”„å¯©å§”å“¡æœƒ',
            'it-online-education': 'è³‡è¨Šæš¨ç·šä¸Šæ•™è‚²å§”å“¡æœƒ',
            'primary-care': 'åŸºå±¤é†«ç™‚å§”å“¡æœƒ',
            'innovation': 'æ–°å‰µå§”å“¡æœƒ',
            'medical-policy-pr': 'é†«ç™‚æ”¿ç­–æš¨å…¬å…±é—œä¿‚å§”å“¡æœƒ',
            'young-urologists': 'é’å¹´äº‹å‹™å§”å“¡æœƒ'
        };

        let currentPage = 1;
        let totalPages = 5; // åˆå§‹é æ•¸ï¼šæ­¡è¿ã€èƒŒæ™¯ã€é¡˜æ™¯ã€å§”å“¡æœƒé¸æ“‡ã€æ„Ÿè¬
        let selectedCommittees = [];
        let dynamicPagesCreated = false;

        function updateProgressBar() {
            const progress = ((currentPage - 1) / (totalPages - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `ç¬¬ ${currentPage} é ï¼Œå…± ${totalPages} é `;
        }

        function changePage(direction) {
            const currentPageElement = document.querySelector('.page.active');
            currentPageElement.classList.remove('active');

            // Create dynamic pages after committee selection (page 4)
            if (currentPage === 4 && direction === 1 && !dynamicPagesCreated) {
                createDynamicPages();
            }

            currentPage += direction;

            // Ensure we don't go beyond the bounds
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            
            // Show the new page
            const pages = document.querySelectorAll('.page');
            pages[currentPage - 1].classList.add('active');

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentPage === 1;
            
            // Reset button visibility
            document.getElementById('nextBtn').style.display = 'block';
            document.getElementById('prevBtn').style.display = 'block';
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºæœ€å¾Œä¸€å€‹å…§å®¹é é¢
            let isLastContentPage = false;
            
            if (selectedCommittees.length > 0) {
                // æœ‰é¸æ“‡å§”å“¡æœƒï¼šæœ€å¾Œä¸€å€‹å§”å“¡æœƒé é¢æ˜¯å€’æ•¸ç¬¬äºŒé 
                isLastContentPage = currentPage === totalPages - 1;
            } else if (selectedCommittees.length === 0 && dynamicPagesCreated) {
                // æ²’æœ‰é¸æ“‡å§”å“¡æœƒï¼šç¬¬4é ï¼ˆå§”å“¡æœƒé¸æ“‡é ï¼‰æ˜¯å€’æ•¸ç¬¬äºŒé 
                isLastContentPage = currentPage === 4;
            }
            
            if (isLastContentPage) {
                document.getElementById('nextBtn').textContent = 'æäº¤å•å·';
                document.getElementById('nextBtn').onclick = () => {
                    submitSurvey();
                    changePage(1); // æäº¤å¾Œè‡ªå‹•è·³åˆ°æ„Ÿè¬é é¢
                };
            } else if (currentPage === totalPages) {
                // æ„Ÿè¬é é¢éš±è—ä¸‹ä¸€é æŒ‰éˆ•
                document.getElementById('nextBtn').style.display = 'none';
            } else {
                // æ‰€æœ‰å…¶ä»–é é¢éƒ½é¡¯ç¤ºä¸‹ä¸€é 
                document.getElementById('nextBtn').textContent = 'ä¸‹ä¸€é ';
                document.getElementById('nextBtn').onclick = () => changePage(1);
            }

            updateProgressBar();
        }

        function createDynamicPages() {
            // Get selected committees
            const checkboxes = document.querySelectorAll('input[name="committees"]:checked');
            selectedCommittees = Array.from(checkboxes).map(cb => cb.value);

            // Remove any existing dynamic pages
            const existingDynamicPages = document.querySelectorAll('.dynamic-page');
            existingDynamicPages.forEach(page => page.remove());

            // If no committees selected, just update total pages
            if (selectedCommittees.length === 0) {
                totalPages = 5; // åŸºæœ¬5é ï¼ˆåŒ…å«æ„Ÿè¬é ï¼‰
                dynamicPagesCreated = true;
                updateProgressBar();
                return;
            }

            // Create a page for each selected committee
            selectedCommittees.forEach((committee, index) => {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'page dynamic-page';
                pageDiv.innerHTML = `
                    <span class="committee-badge">æ”¿è¦‹å»ºè­° ${index + 1}/${selectedCommittees.length}</span>
                    <h2>${committeeNames[committee]}</h2>
                    
                    <div class="question-group">
                        <div class="question-label">1. ç¾æ³è§€å¯Ÿèˆ‡æŒ‘æˆ°</div>
                        <p style="margin-bottom: 10px; color: #666;">æ‚¨èªç‚ºæ­¤å§”å“¡æœƒç›®å‰é¢è‡¨æœ€å¤§çš„æŒ‘æˆ°ï¼Œæˆ–æœ‰å“ªäº›å¯ä»¥åšå¾—æ›´å¥½çš„åœ°æ–¹ï¼Ÿ</p>
                        <textarea class="committee-challenge" data-committee="${committee}" placeholder="è«‹åˆ†äº«æ‚¨å°ç¾æ³çš„è§€å¯Ÿ..."></textarea>
                    </div>
                    
                    <div class="question-group">
                        <div class="question-label">2. æœªä¾†æ”¿è¦‹èˆ‡æ–¹å‘</div>
                        <p style="margin-bottom: 10px; color: #666;">æ‚¨å¸Œæœ›æœªä¾†çš„ç†äº‹é•·èƒ½åœ¨æ­¤å§”å“¡æœƒæ¨å‹•å“ªäº›å…·é«”æ”¿ç­–ã€æ´»å‹•æˆ–æ”¹é©ï¼Ÿ</p>
                        <textarea class="committee-future" data-committee="${committee}" placeholder="è«‹åˆ†äº«æ‚¨å°æœªä¾†çš„å»ºè­°..."></textarea>
                    </div>
                `;

                // Insert before thank you page
                const thankYouPage = document.getElementById('thankYouPage');
                thankYouPage.parentNode.insertBefore(pageDiv, thankYouPage);
            });

            // Update total pages
            totalPages = 5 + selectedCommittees.length;
            dynamicPagesCreated = true;
            updateProgressBar();
        }

        function collectFormData() {
            const formData = {
                workplace: document.querySelector('input[name="workplace"]:checked')?.value || '',
                experience: document.querySelector('input[name="experience"]:checked')?.value || '',
                selectedCommittees: selectedCommittees,
                committeeResponses: {},
                crossDisciplinary: document.getElementById('crossDisciplinary').value,
                highlightPolicy: document.getElementById('highlightPolicy').value
            };

            // Collect committee-specific responses
            selectedCommittees.forEach(committee => {
                formData.committeeResponses[committee] = {
                    challenges: document.querySelector(`.committee-challenge[data-committee="${committee}"]`)?.value || '',
                    future: document.querySelector(`.committee-future[data-committee="${committee}"]`)?.value || ''
                };
            });

            return formData;
        }

        function submitSurvey() {
            const formData = collectFormData();
            console.log('Survey Data:', formData);
            
            // é¡¯ç¤ºæäº¤ä¸­çš„ç‹€æ…‹
            const submitBtn = document.getElementById('nextBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'è³‡æ–™æäº¤ä¸­...';
            
            // Google Apps Script Web App URL
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyMXHzRfPuNmxtFCL6OT_oKtW-Z4l2Ktc76DwyXOXHQiCuZNDeLzqyDCkW-9aKLmVY4/exec';
            
            // æº–å‚™è¦ç™¼é€çš„è³‡æ–™ï¼ˆç°¡åŒ–æ ¼å¼ï¼‰
            const formDataEncoded = new FormData();
            formDataEncoded.append('timestamp', new Date().toISOString());
            formDataEncoded.append('workplace', formData.workplace || '');
            formDataEncoded.append('experience', formData.experience || '');
            formDataEncoded.append('selectedCommittees', formData.selectedCommittees.join(';'));
            formDataEncoded.append('crossDisciplinary', formData.crossDisciplinary || '');
            formDataEncoded.append('highlightPolicy', formData.highlightPolicy || '');
            
            // æ·»åŠ å§”å“¡æœƒå›æ‡‰
            formData.selectedCommittees.forEach(committee => {
                if (formData.committeeResponses[committee]) {
                    formDataEncoded.append(`${committee}_challenges`, formData.committeeResponses[committee].challenges || '');
                    formDataEncoded.append(`${committee}_future`, formData.committeeResponses[committee].future || '');
                }
            });
            
            // ä½¿ç”¨ fetch ç™¼é€è«‹æ±‚
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                body: formDataEncoded
            })
            .then(response => response.text())
            .then(result => {
                console.log('Success:', result);
                alert('å•å·å·²æˆåŠŸæäº¤è‡³ Google Sheetsï¼');
                submitBtn.textContent = 'âœ“ å·²æäº¤';
                
                // é¡¯ç¤ºåŒ¯å‡ºé¸é …
                showExportOptionsAfterSubmit(formData);
                
                // è·³è½‰åˆ°æ„Ÿè¬é é¢
                setTimeout(() => {
                    changePage(1);
                }, 1000);
            })
            .catch(error => {
                console.error('Error:', error);
                // å‚™ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ iframe æäº¤
                submitViaIframe(GOOGLE_SCRIPT_URL, formData);
            });
        }

        function submitViaIframe(url, formData) {
            // å‰µå»ºéš±è—çš„è¡¨å–®
            const form = document.createElement('form');
            form.style.display = 'none';
            form.method = 'POST';
            form.action = url;
            form.target = 'hidden_iframe';
            
            // æ·»åŠ åŸºæœ¬æ¬„ä½
            const fields = {
                timestamp: new Date().toISOString(),
                workplace: formData.workplace || '',
                experience: formData.experience || '',
                selectedCommittees: formData.selectedCommittees.join(';'),
                crossDisciplinary: formData.crossDisciplinary || '',
                highlightPolicy: formData.highlightPolicy || ''
            };
            
            // æ·»åŠ è¡¨å–®æ¬„ä½
            for (const [key, value] of Object.entries(fields)) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = value;
                form.appendChild(input);
            }
            
            // æ·»åŠ å§”å“¡æœƒå›æ‡‰
            formData.selectedCommittees.forEach(committee => {
                if (formData.committeeResponses[committee]) {
                    const challengeInput = document.createElement('input');
                    challengeInput.type = 'hidden';
                    challengeInput.name = `${committee}_challenges`;
                    challengeInput.value = formData.committeeResponses[committee].challenges || '';
                    form.appendChild(challengeInput);
                    
                    const futureInput = document.createElement('input');
                    futureInput.type = 'hidden';
                    futureInput.name = `${committee}_future`;
                    futureInput.value = formData.committeeResponses[committee].future || '';
                    form.appendChild(futureInput);
                }
            });
            
            // å‰µå»ºéš±è—çš„ iframe
            const iframe = document.createElement('iframe');
            iframe.name = 'hidden_iframe';
            iframe.id = 'hidden_iframe';
            iframe.style.display = 'none';
            
            // æ·»åŠ åˆ°é é¢
            document.body.appendChild(iframe);
            document.body.appendChild(form);
            
            // è¨­å®š iframe è¼‰å…¥å®Œæˆçš„è™•ç†
            iframe.onload = function() {
                setTimeout(() => {
                    alert('å•å·å·²æäº¤ï¼');
                    document.getElementById('nextBtn').textContent = 'âœ“ å·²æäº¤';
                    
                    // é¡¯ç¤ºåŒ¯å‡ºé¸é …
                    showExportOptionsAfterSubmit(collectFormData());
                    
                    // æ¸…ç†
                    document.body.removeChild(form);
                    document.body.removeChild(iframe);
                    
                    // è·³è½‰åˆ°æ„Ÿè¬é é¢
                    changePage(1);
                }, 1000);
            };
            
            // æäº¤è¡¨å–®
            form.submit();
        }

        // é¡¯ç¤ºç°¡åŒ–çš„åŒ¯å‡ºé¸é …
        function showExportOptionsAfterSubmit(formData) {
            // å‰µå»ºåŒ¯å‡ºé¸é …é¢æ¿
            const exportPanel = document.createElement('div');
            exportPanel.className = 'export-panel';
            exportPanel.innerHTML = `
                <div class="export-panel-content">
                    <h3>ä¿å­˜æ‚¨çš„å›è¦†</h3>
                    <p>è«‹é¸æ“‡ä¸€ç¨®æ–¹å¼ä¿å­˜æ‚¨çš„å•å·å›è¦†ï¼š</p>
                    <div class="export-options">
                        <button class="btn btn-primary" onclick="exportToPDF(${JSON.stringify(formData).replace(/"/g, '&quot;')})">
                            ğŸ“„ ä¸‹è¼‰ PDF æª”æ¡ˆ
                        </button>
                        <button class="btn btn-primary" onclick="exportToCSV(${JSON.stringify(formData).replace(/"/g, '&quot;')})">
                            ğŸ“Š ä¸‹è¼‰ CSV æª”æ¡ˆ
                        </button>
                        <button class="btn btn-primary" onclick="copyToClipboard(${JSON.stringify(formData).replace(/"/g, '&quot;')})">
                            ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼ç°¿
                        </button>
                    </div>
                    <button class="btn btn-secondary" onclick="this.parentElement.parentElement.remove()">é—œé–‰</button>
                </div>
            `;
            document.body.appendChild(exportPanel);
        }

        // è¤‡è£½åˆ°å‰ªè²¼ç°¿åŠŸèƒ½
        function copyToClipboard(formData) {
            let text = 'TUA 2026 Vision Survey å•å·å›è¦†\n';
            text += '='.repeat(40) + '\n\n';
            
            text += `æäº¤æ™‚é–“ï¼š${new Date().toLocaleString()}\n`;
            text += `åŸ·æ¥­å ´æ‰€ï¼š${formData.workplace || 'æœªå¡«å¯«'}\n`;
            text += `åŸ·æ¥­å¹´è³‡ï¼š${formData.experience || 'æœªå¡«å¯«'}\n\n`;
            
            text += 'ã€ç¸½é«”é¡˜æ™¯ã€‘\n';
            text += `è·¨é ˜åŸŸç¶œåˆå»ºè­°ï¼š\n${formData.crossDisciplinary || 'ç„¡'}\n\n`;
            text += `äº®é»æ”¿è¦‹ï¼š\n${formData.highlightPolicy || 'ç„¡'}\n\n`;
            
            if (formData.selectedCommittees.length > 0) {
                text += 'ã€å§”å“¡æœƒå»ºè­°ã€‘\n';
                formData.selectedCommittees.forEach(committee => {
                    const response = formData.committeeResponses[committee];
                    if (response) {
                        text += `\n${committeeNames[committee]}\n`;
                        text += '-'.repeat(30) + '\n';
                        text += `ç¾æ³æŒ‘æˆ°ï¼š${response.challenges || 'ç„¡'}\n`;
                        text += `æœªä¾†æ–¹å‘ï¼š${response.future || 'ç„¡'}\n`;
                    }
                });
            }
            
            // è¤‡è£½åˆ°å‰ªè²¼ç°¿
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        alert('å·²æˆåŠŸè¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼æ‚¨å¯ä»¥è²¼åˆ°ä»»ä½•æ–‡ä»¶ä¸­ä¿å­˜ã€‚');
                    })
                    .catch(() => {
                        // å‚™ç”¨æ–¹æ¡ˆ
                        fallbackCopyToClipboard(text);
                    });
            } else {
                // å‚™ç”¨æ–¹æ¡ˆ
                fallbackCopyToClipboard(text);
            }
        }

        // å‚™ç”¨çš„è¤‡è£½åˆ°å‰ªè²¼ç°¿æ–¹æ³•
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.top = '-9999px';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('å·²æˆåŠŸè¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            } catch (err) {
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸æ“‡æ–‡å­—è¤‡è£½ã€‚');
            }
            
            document.body.removeChild(textArea);
        }

        function showExportOptionsAfterSubmit(formData) {
            // å‰µå»ºä¸€å€‹è¼ƒå°çš„æç¤ºæ¡†ï¼Œé¡¯ç¤ºåœ¨å³ä¸‹è§’
            const notification = document.createElement('div');
            notification.className = 'export-notification';
            notification.innerHTML = `
                <div class="export-notification-content">
                    <p>è³‡æ–™å·²æäº¤ï¼æ‚¨ä¹Ÿå¯ä»¥ï¼š</p>
                    <div class="export-quick-buttons">
                        <button class="btn-small" onclick="exportToPDF(${JSON.stringify(formData).replace(/"/g, '&quot;')})">
                            ğŸ“„ ä¸‹è¼‰ PDF
                        </button>
                        <button class="btn-small" onclick="exportToCSV(${JSON.stringify(formData).replace(/"/g, '&quot;')})">
                            ğŸ“Š ä¸‹è¼‰ CSV
                        </button>
                    </div>
                    <button class="close-btn" onclick="this.parentElement.parentElement.remove()">âœ•</button>
                </div>
            `;
            document.body.appendChild(notification);
            
            // 10ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 10000);
        }

        function closeExportModal() {
            const modal = document.querySelector('.export-modal');
            if (modal) {
                modal.remove();
            }
        }

        // åŒ¯å‡ºç‚º PDF
        function exportToPDF(formData) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // è¨­å®šä¸­æ–‡å­—é«”ï¼ˆä½¿ç”¨å…§å»ºå­—é«”ï¼Œå¯¦éš›æ‡‰ç”¨éœ€è¦åŠ è¼‰ä¸­æ–‡å­—é«”ï¼‰
            doc.setFont('helvetica');
            
            // æ¨™é¡Œ
            doc.setFontSize(20);
            doc.text('TUA 2026 Vision Survey Results', 20, 20);
            
            // åŸºæœ¬è³‡è¨Š
            doc.setFontSize(12);
            let yPosition = 40;
            
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, yPosition);
            yPosition += 10;
            
            doc.text(`Workplace: ${formData.workplace || 'Not specified'}`, 20, yPosition);
            yPosition += 10;
            
            doc.text(`Experience: ${formData.experience || 'Not specified'}`, 20, yPosition);
            yPosition += 20;
            
            // å§”å“¡æœƒå»ºè­°
            doc.setFontSize(14);
            doc.text('Committee Suggestions:', 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(11);
            formData.selectedCommittees.forEach(committee => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.text(`${committeeNames[committee]}:`, 20, yPosition);
                yPosition += 8;
                
                const response = formData.committeeResponses[committee];
                if (response.challenges) {
                    const challengeLines = doc.splitTextToSize(`Challenges: ${response.challenges}`, 170);
                    doc.text(challengeLines, 25, yPosition);
                    yPosition += challengeLines.length * 5 + 5;
                }
                
                if (response.future) {
                    const futureLines = doc.splitTextToSize(`Future Direction: ${response.future}`, 170);
                    doc.text(futureLines, 25, yPosition);
                    yPosition += futureLines.length * 5 + 10;
                }
            });
            
            // ç¶œåˆå»ºè­°
            if (yPosition > 220) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.setFontSize(14);
            doc.text('Overall Suggestions:', 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(11);
            if (formData.crossDisciplinary) {
                const crossLines = doc.splitTextToSize(`Cross-disciplinary: ${formData.crossDisciplinary}`, 170);
                doc.text(crossLines, 20, yPosition);
                yPosition += crossLines.length * 5 + 10;
            }
            
            if (formData.highlightPolicy) {
                const policyLines = doc.splitTextToSize(`Highlight Policy: ${formData.highlightPolicy}`, 170);
                doc.text(policyLines, 20, yPosition);
            }
            
            // å„²å­˜ PDF
            doc.save('TUA_2026_Survey_Results.pdf');
            
            alert('PDF å·²æˆåŠŸä¸‹è¼‰ï¼');
        }

        // åŒ¯å‡ºç‚º CSV
        function exportToCSV(formData) {
            let csvContent = '\ufeff'; // UTF-8 BOM
            
            // å»ºç«‹ CSV æ¨™é¡Œåˆ—
            const headers = ['æäº¤æ™‚é–“', 'åŸ·æ¥­å ´æ‰€', 'åŸ·æ¥­å¹´è³‡', 'é¸æ“‡çš„å§”å“¡æœƒ'];
            
            // ç‚ºæ¯å€‹å¯èƒ½çš„å§”å“¡æœƒæ·»åŠ å…©å€‹æ¬„ä½ï¼ˆç¾æ³æŒ‘æˆ°ã€æœªä¾†æ–¹å‘ï¼‰
            Object.keys(committeeNames).forEach(key => {
                headers.push(`${committeeNames[key]}-ç¾æ³æŒ‘æˆ°`);
                headers.push(`${committeeNames[key]}-æœªä¾†æ–¹å‘`);
            });
            
            headers.push('è·¨é ˜åŸŸç¶œåˆå»ºè­°', 'äº®é»æ”¿è¦‹');
            
            csvContent += headers.join(',') + '\n';
            
            // å»ºç«‹è³‡æ–™åˆ—
            const row = [
                new Date().toLocaleString(),
                formData.workplace || '',
                formData.experience || '',
                formData.selectedCommittees.join(';')
            ];
            
            // æ·»åŠ æ¯å€‹å§”å“¡æœƒçš„å›æ‡‰
            Object.keys(committeeNames).forEach(key => {
                if (formData.committeeResponses[key]) {
                    row.push(`"${formData.committeeResponses[key].challenges || ''}"`);
                    row.push(`"${formData.committeeResponses[key].future || ''}"`);
                } else {
                    row.push('');
                    row.push('');
                }
            });
            
            row.push(`"${formData.crossDisciplinary || ''}"`);
            row.push(`"${formData.highlightPolicy || ''}"`);
            
            csvContent += row.join(',') + '\n';
            
            // ä¸‹è¼‰ CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'TUA_2026_Survey_Results.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('CSV æª”æ¡ˆå·²æˆåŠŸä¸‹è¼‰ï¼');
        }

        // æäº¤åˆ° Google Sheets
        function submitToGoogleSheets(formData) {
            // é¡¯ç¤ºæäº¤ä¸­çš„ç‹€æ…‹
            const submitButton = event.target;
            submitButton.disabled = true;
            submitButton.textContent = 'æäº¤ä¸­...';
            
            // Google Apps Script Web App URL
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyMXHzRfPuNmxtFCL6OT_oKtW-Z4l2Ktc76DwyXOXHQiCuZNDeLzqyDCkW-9aKLmVY4/exec';
            
            // æº–å‚™è¦ç™¼é€çš„è³‡æ–™
            const payload = {
                timestamp: new Date().toISOString(),
                workplace: formData.workplace || '',
                experience: formData.experience || '',
                selectedCommittees: formData.selectedCommittees.join(';'),
                committeeResponses: JSON.stringify(formData.committeeResponses),
                crossDisciplinary: formData.crossDisciplinary || '',
                highlightPolicy: formData.highlightPolicy || ''
            };
            
            // ç™¼é€è³‡æ–™åˆ° Google Apps Script
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(() => {
                alert('è³‡æ–™å·²æˆåŠŸæäº¤è‡³ Google Sheetsï¼');
                submitButton.textContent = 'âœ“ å·²æäº¤';
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                submitButton.disabled = false;
                submitButton.textContent = 'â˜ï¸ å„²å­˜è‡³ Google Sheets';
            });
        }

        // Initialize
        updateProgressBar();
    </script>
</body>
</html>